<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>光彩异联</title>
        <meta name="description" content="">
        <meta name="keywords" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
        <meta name="renderer" content="webkit">
        <meta http-equiv="Cache-Control" content="no-siteapp" />
        <link rel="icon" type="image/png" href="/theme/default/images/favicon.png">
    <link href="css/amazeui.min.css" rel="stylesheet" type="text/css" />
    <link href="css/style.css" rel="stylesheet" type="text/css" />
    <style>
        table#tt{font-size: 1.4rem;text-align: center;}
        table#tt thead tr th{font-weight: 400;border:1px solid #efefef;text-align: center;}
        table#tt tbody tr td{font-weight: 400;border:1px solid #efefef;text-align: center;}
        #toolbar .excelbtn{margin:10px 0;text-align: center;}
        #toolbar .excelbtn a{margin: 0;border: 0;color: #fff;font-size: 1.4rem;border-radius: 3px;background: #FF6946;display: inline-block;width: 70px;height: 30px;line-height: 30px;}

        .d_search{}
        .d_search input{border-radius: 3px 0 0 3px;border-right: none;}
        .d_search a{margin: 5px 0;width: 20%;float: right;color: #fff;font-size: 1.4rem;background: #FF6946;display: inline-block;height: 37px;line-height: 37px;text-align: center;}

        table.edittable tbody tr td:first-child{text-align: right;}
        table.edittable tbody tr td:last-child input{margin-left: 10px;}
        table.edittable tbody tr td:last-child img{margin-left: 10px;}

        input{width:80%;margin: 5px 0 5px 0;font-size: 1.4rem;padding: 8px 10px;border-radius: 3px;border: 1px solid #e9e9e9;background: #FFFFFF;}
        .d_search span{width: 25%;display: inline-block;}
        #dlg-buttons{text-align: center;margin: 0 0 20px 0;}
        #dlg-buttons a{margin: 10px 5px;border: 0;color: #fff;font-size: 1.6rem;padding: 5px 25px;border-radius: 3px;background: #FF6946;}
    </style>
  </head>
  <body>
    <header data-am-widget="header" class="am-header am-header-default sq-head ">
      <div class="am-header-left am-header-nav">
        <a href="javascript:history.back()" class="">
          <i class="am-icon-chevron-left"></i>
        </a>
      </div>
      <h1 class="am-header-title"><a href="" class="">商家信息</a></h1>
    </header>
    <div style="height: 49px;"></div>

    <form acceptbutton="searchBtn" style="margin: 0 20px;">
    <table width="100%" id="tt" class="easyui-datagrid" url="/shop/ShopProduct/GetProductList" idField="productid" method="post" style=""
           title="商品信息管理" toolbar="#toolbar" singleSelect="false" pagination="true">
        <thead>
            <tr>
                <th align="center" width="16%" field="productid" checkbox="true">记录ID</th>
                <th align="center" width="16%" field="productname">商品名</th>
                <th align="center" width="16%" field="price">价格</th>
                <th align="center" width="16%" field="score">积分</th>
                <th align="center" width="16%" field="inventory">数量</th>
                <th align="center" width="16%" field="createtime" sortable="true">创建时间</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>77581312</td>
                <td>西瓜</td>
                <td>123.00</td>
                <td>123</td>
                <td>12</td>
                <td>2016-11-18</td>
            </tr>
        </tbody>
    </table>

    <div id="toolbar">
        <div class="excelbtn">
            <a href="#" class="easyui-linkbutton" iconCls="icon-add" plain="true" onclick="Add()">添加</a>
            <a href="#" class="easyui-linkbutton" iconCls="icon-edit" plain="true" onclick="Edit()">编辑</a>
            <a href="#" class="easyui-linkbutton" iconCls="icon-remove" plain="true" onclick="Del()">删除</a>
        </div>
        <div class="d_search">
            <input value="" id="tbProductName" placeholder="待搜索的产品名" />
            <a href="#" class="easyui-linkbutton" id="searchBtn" plain="true" onclick="doSearch()">搜索</a>

        </div>

    </div>
    </form>

    <!-- 添加修改对话框 -->
    <div id="dlg" class="easyui-dialog" style="padding:10px 20px" closed="true" buttons="#dlg-buttons">
        <div class="ftitle">平台信息</div>
        <form id="fm" method="post">
            <div class="easyui-tabs" style="width:100%;overflow:hidden;">
                <div title="基本信息" style="padding:5px;">
                    <table class="edittable" style=" width:100%;">
                        <tr>
                            <td>商品名:</td>
                            <td>  <input id="productname" name="productname" class="easyui-validatebox" required="true"></td>
                        </tr>
                        <tr>
                            <td>批发价格:</td>
                            <td> <input id="price" name="price" class="easyui-numberbox" precision="2" required="true"></td>
                        </tr>
                        <tr id="tr_score">
                            <td>批发馈赠积分:</td>
                            <td> <input id="score" name="score" class="easyui-numberbox" precision="0" required="true"></td>
                        </tr>
                        <tr>
                            <td>起批量:</td>
                            <td> <input id="sellmix" name="sellmix" class="easyui-numberbox" precision="0" required="true"></td>
                        </tr>
                        <tr>
                            <td>零售价格:</td>
                            <td> <input id="sellprice" name="sellprice" class="easyui-numberbox" precision="2" required="true"></td>
                        </tr>
                        <tr>
                            <td>零售馈赠积分:</td>
                            <td> <input id="sellscore" name="sellscore" class="easyui-numberbox" precision="0" required="true"></td>
                        </tr>           
                        <tr>
                            <td>库存数量:</td>
                            <td> <input id="inventory" name="inventory" class="easyui-numberbox" precision="0" required="true"></td>
                        </tr>
                        <tr>
                            <td>内容:</td>
                            <td>
                                <input id="content" name="content" class="easyui-textbox" data-options="multiline:true" style="height:60px" />
                            </td>
                        </tr>
                        <tr>
                            <td>商品图片:</td>
                            <td>
                                <input type="hidden" id="logo" name="logo" />
                                <img id="imgpic1" src="~/upload/addfile.png" style="width:88px;height:75px" title="点击上传" onclick="javascript: return $('#imgfile1').click(); " />
                                <input style="display:none;" type="file" id="imgfile1" name="imgfile1" onchange="javascript: FileUpload('imgfile1', 'imgpic1', 'shopimg', 'logo');" />
                            </td>
                        </tr>
                    </table>
                </div>
                <div title="商品详情" style="padding:5px">
                    <script id="editor" type="text/plain" style="width:100%;height:390px;" required="true">
                    </script>
                    <textarea id="content" name="content" rows="2" cols="20" style="display:none;" required="false"></textarea>
                </div>
                <div title="商品广告图" style="padding:5px">
                    <!-- <table class="edittable" style=" width:100%;">
                        <tr>
                            <td>广告图:</td>
                            <td>
                                <input id="logoad" name="logoad" type="hidden">
                                <div id="logo1">
                                    <div id="fileList" class="uploader-list"></div>
                                    <div id="filePicker" class="webuploader-container">
                                        <div class="webuploader-pick">选择图片</div>
                                        <div class="webuploader-div">
                                            <input type="file" name="file" class="webuploader-element-invisible" multiple="multiple" accept="image/*" />
                                            <label class="webuploader-label"></label>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </table> -->
                    <div class="upbox">
                        <p>广告图:</p>
                        <div class="upload_img">
                            <input id="logoad" name="logoad" type="hidden">
                            <div id="logo1">
                                <div id="fileList" class="uploader-list"></div>
                                <div id="filePicker" class="webuploader-container">
                                    <div class="webuploader-pick" style="display:inline-block;float:left;width:20%;">选择图片</div>
                                    <div class="webuploader-div" style="display:inline-block;width:80%;">
                                        <input style="width:100%;" type="file" name="file" class="webuploader-element-invisible" multiple="multiple" accept="image/*" />
                                        <label class="webuploader-label"></label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>

    </div>
    <div id="dlg-buttons">
        <div>
            <a href="#" class="easyui-linkbutton" iconCls="icon-ok" onclick="saveUser()">保存</a>
            <a href="#" class="easyui-linkbutton" iconCls="icon-cancel" onclick="javascript:$('#dlg').dialog('close')">取消</a>
        </div>
    </div>

  </body>
  <script src="js/zepto.js"></script>
  <script>
    var ue = UE.getEditor('editor');
    function createWebuploader() {
        createImg('logo1', 'fileList', 'filePicker');
        CreateImgUpload('fileList', 'filePicker');
    }

    function Add() {
        $('#dlg').dialog('open').dialog('setTitle', '新增');
        $('#fm').form('clear');
        url = '/shop/ShopProduct/Add';
        createWebuploader();
        imgcheck('', "logo", "imgpic1");

        $.post('/shop/ShopInfo/GetDataList', function (result) {
            if (result.ismanufactor == 0 || result.isdistribution == 1) {
                $('#tr_score').hide();
                $('#score').numberbox('setValue', 0);
            }
            else {
                $('#tr_score').show();
            }
        }, 'json');

        UE.getEditor('editor').setContent('');
    }
    function Edit() {
        var row = $('#tt').datagrid('getSelected');
        if (row) {
            $('#dlg').dialog('open').dialog('setTitle', '编辑- ' + row.productname);
            $('#fm').form('load', row);
            url = '/shop/ShopProduct/Edit/' + row.productid;

            //$('#content').textbox('setValue', decodeURIComponent(row.content));
            imgcheck(row.logo, "logo", "imgpic1");
            createWebuploader();
            loadLogo(row.productid);

            $.post('/shop/ShopInfo/GetDataList', function (result) {
                if (result.ismanufactor == 0 || result.isdistribution == 1) {
                    $('#tr_score').hide();
                    $('#score').numberbox('setValue', 0);
                }
                else {
                    $('#tr_score').show();
                }
            }, 'json');

            UE.getEditor('editor').setContent(decodeURI(row.content));
        }
        else {
            $.messager.alert("提示", "请选中要操作的记录!");
        }
    }

    function loadLogo(productid) {
        $.post('/shop/ShopProduct/GetProductLogo/' + productid, function (result) {
            $('#fileList').append($(result).map(function () {
                return CreateImgHtml(this.logo, this.id)
            }).get().join(''));
        }, 'json');
    }

    function saveUser() {
        var content = UE.getEditor('editor').getContent();
        if (content, length > 0)
            $("#content").val(encodeURI(content));

        $('#logoad').val(getImgUrl('fileList'));
        //var content = $('#content').textbox('getValue');
        //if (content.length <= 0) {
        //    $.messager.alert("提示", "请输入内容!");
        //    return;
        //}
        //else {
        //    $("#content").textbox('setValue',encodeURIComponent(content));
        //}
        $('#fm').form('submit', {
            url: url,
            method: "post",
            onSubmit: function () {
                return $(this).form('validate');
            },
            success: function (result) {
                var result = eval('(' + result + ')');
                if (result.errorMsg) {
                    //$("#content").textbox('setValue', decodeURIComponent(content));
                    $.messager.show({
                        title: 'Error',
                        msg: result.errorMsg
                    });
                } else {
                    $('#dlg').dialog('close');      // close the dialog
                    $('#tt').datagrid('reload');    // reload the user data
                    //$('#tt').datagrid('getSelected').length = 0;
                    //$("#dg").datagrid("unselectRow", $("#dg").datagrid("getSelections"));
                }
            }
        });
    }
    function doSearch() {
        $('#tt').datagrid('load', {
            productname: $('#tbProductName').val(),
            shopname: $('#tbShopName').val()
        });
    }


    function Del() {
        var rows = $('#tt').datagrid('getSelections');
        if (rows.length > 0) {
            var idarr = "";
            for (var i = 0; i < rows.length; i++) {
                if ((i + 1) == rows.length) {
                    idarr += rows[i].productid;
                }
                else {
                    idarr += rows[i].productid + ",";
                }
            }
            $.messager.confirm('确认', '确定要删除选中记录?', function (r) {
                if (r) {
                    $.post('/shop/ShopProduct/Del/' + idarr, function (result) {
                        if (result.success) {
                            $('#tt').datagrid('reload');    // reload the user data
                        } else {
                            $.messager.show({   // show error message
                                title: 'Error',
                                msg: result.errorMsg
                            });
                        }
                    }, 'json');
                }
            });
        }
        else {
            $.messager.alert("提示", "请选中要操作的记录!");
        }
    }
</script>
</html>

